<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitoramento do Caminhão de Coleta</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        /* Adicione estilos básicos */
        #map { height: 400px; width: 100%; }
        .location-container { padding: 20px; }
    </style>
</head>
<body>
    <div class="location-container" id="monitoramento">
        <div class="clock-container">
            <div id="clock">00:00:00</div>
        </div>
        <div class="localizacao">
            <h2>Localização Atual do Caminhão:</h2>
            <p id="current-location">Calculando...</p>
            <h2>Próxima Localização:</h2>
            <p id="future-location">Calculando...</p>
        </div>
    </div>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        // Exemplo de rotas (adapte com suas ruas e coordenadas)
        const route = [
            { rua: "Rua Afonso Pena", bairro: "Centro", start: "08:00", end: "08:20", dias: ["segunda", "terça"], latLng: [-30.0346, -51.2175] },
            { rua: "Avenida Bento Gonçalves", bairro: "Partenon", start: "08:40", end: "09:00", dias: ["quinta"], latLng: [-30.0395, -51.2177] },
            { rua: "Rua General Neto", bairro: "Floresta", start: "09:00", end: "09:20", dias: ["sexta"], latLng: [-30.0400, -51.2200] },
            // Adicione mais rotas conforme necessário
        ];

        // Inicializa o mapa
        const map = L.map('map').setView([-30.0346, -51.2175], 13); // Centraliza o mapa na primeira localização
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
        }).addTo(map);

        const truckMarker = L.marker([-30.0346, -51.2175]).addTo(map); // Marker inicial

        // Converte o tempo em minutos
        function timeToMinutes(time) {
            const [hour, minute] = time.split(':').map(Number);
            return hour * 60 + minute;
        }

        // Atualiza o relógio e a localização do caminhão
        function updateClock() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            document.getElementById('clock').textContent = `${hours}:${minutes}:${seconds}`;

            // Verifica localização atual do caminhão
            const currentLocation = getCurrentLocation(now);
            document.getElementById('current-location').textContent = currentLocation || "Nenhuma coleta no momento";

            // Calcular próxima coleta
            const nextCollection = getNextCollection(now);
            document.getElementById('future-location').textContent = nextCollection || "Nenhuma coleta prevista";
        }

        // Função para obter a localização atual do caminhão
        function getCurrentLocation(time) {
            const currentTime = `${String(time.getHours()).padStart(2, '0')}:${String(time.getMinutes()).padStart(2, '0')}`;
            const dayOfWeek = time.toLocaleString('pt-BR', { weekday: 'long' }).toLowerCase();

            for (const item of route) {
                if (currentTime >= item.start && currentTime < item.end && item.dias.includes(dayOfWeek)) {
                    truckMarker.setLatLng(item.latLng);  // Atualiza a localização do caminhão no mapa
                    map.panTo(item.latLng);  // Centraliza o mapa na nova posição do caminhão
                    return `${item.rua}, ${item.bairro}`;
                }
            }
            return null;
        }

        // Função para encontrar a próxima coleta
        function getNextCollection(time) {
            const dayOfWeek = time.toLocaleString('pt-BR', { weekday: 'long' }).toLowerCase();
            for (const item of route) {
                if (item.dias.includes(dayOfWeek) && timeToMinutes(item.start) > timeToMinutes(`${String(time.getHours()).padStart(2, '0')}:${String(time.getMinutes()).padStart(2, '0')}`)) {
                    return `Próxima coleta: ${item.rua}, ${item.bairro} (${item.start} - ${item.end})`;
                }
            }
            return "Nenhuma coleta prevista";
        }

        // Atualiza o relógio a cada segundo
        setInterval(updateClock, 1000);
        updateClock();  // Chamada inicial para exibir o relógio imediatamente
    </script>
</body>
</html>
